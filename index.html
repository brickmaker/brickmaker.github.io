<!DOCTYPE html>













<html class="theme-next mist" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Coder love Design">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiaodong&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Xiaodong&#39;s Blog">
<meta property="og:description" content="Coder love Design">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiaodong&#39;s Blog">
<meta name="twitter:description" content="Coder love Design">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Xiaodong's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaodong's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Coder love Design</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/02/web-user-system-2019-02-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/02/web-user-system-2019-02-02/" itemprop="url">
                  Web开发中的用户系统（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-02 19:06:59" itemprop="dateCreated datePublished" datetime="2019-02-02T19:06:59+08:00">2019-02-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-10 19:33:10" itemprop="dateModified" datetime="2019-02-10T19:33:10+08:00">2019-02-10</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/02/web-user-system-2019-02-02/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/02/web-user-system-2019-02-02/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>好多Web场景中都会用到用户系统。但Web基于的协议是一个无状态的协议，于是出现了许多幺蛾子来解决，这些的确让自己很头疼，自己一直以来都没怎么搞明白，甚至好多名词都不知道。这次，下定决心了解一波，总结一下。</p>
<p>任务有如下：</p>
<ol>
<li>了解用户系统的一堆名词，authentication、authorization、OAuth、OAuth2、JWT、Session、token等等</li>
<li>理解实现用户认证和授权的方法与流程</li>
<li>了解主要的用户系统实现方案</li>
<li>选择一个库/方案，实现一个用户系统</li>
</ol>
<hr>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="authentication-amp-authorization"><a href="#authentication-amp-authorization" class="headerlink" title="authentication &amp; authorization"></a>authentication &amp; authorization</h3><p>翻译的话，authentication：认证；authorization：授权</p>
<p>StackOverflow上的回答很好了：<a href="https://stackoverflow.com/questions/6556522/authentication-versus-authorization" target="_blank" rel="external">https://stackoverflow.com/questions/6556522/authentication-versus-authorization</a></p>
<p>简单的说，认证是确认当前操作的的确是某人操作的；授权是确认当前操作是某人权限范围内。</p>
<p>回答里有人说这是Orthognal的，互不相干的，但我感觉还是有关系的吧，没有认证，哪来的授权？</p>
<p>了解概念，其实就是知道这是俩东西，需要各自考虑和处理。</p>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>一直不了解session是个什么东西，捉摸不透，看了好多博客、tutorial，发现也各有各的说法，仍然很迷。</p>
<p>感觉，session所指的东西，应该有两种意思，一种是抽象的，接近session英文单词的本意，说的就是一种机制，一种实现有状态会话的机制；另一种是具体的，是指这种机制（有人称之为cookie-session机制，我觉得挺好）下，存在服务器上的那个东西，可能好多库都这样叫，于是人们也这样叫吧，我觉得取名<code>sessionInfo</code>应该会更好。</p>
<h3 id="JWT-token"><a href="#JWT-token" class="headerlink" title="JWT, token"></a>JWT, token</h3><p>JWT是一种方案/机制，这是自己知道的，所谓的token-based authentication，基本指的就是JWT这个机制了。</p>
<p>这篇文章看了感觉讲的还挺清楚的：<a href="https://dzone.com/articles/cookies-vs-tokens-the-definitive-guide" target="_blank" rel="external">https://dzone.com/articles/cookies-vs-tokens-the-definitive-guide</a></p>
<h3 id="OAuth-OAuth-2-0"><a href="#OAuth-OAuth-2-0" class="headerlink" title="OAuth, OAuth 2.0"></a>OAuth, OAuth 2.0</h3><p>这两个应该是标准，全称是Open Authorization，2.0是最新版？大概是这个意思吧。</p>
<p>有官网：<a href="https://oauth.net/2/" target="_blank" rel="external">https://oauth.net/2/</a></p>
<p>Wikipedia:</p>
<blockquote>
<p>开放授权（OAuth）是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。</p>
<p>OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。</p>
</blockquote>
<p>所以，简单来说的话，就是当一个应用想用第三方应用的信息比如Google的昵称和头像的时候，有权限得到，而不用得到Google的账号和密码。</p>
<p>本质上和用户系统没有什么关系，其实当用户用第三方登录的时候，只是用了第三方的某些信息注册了一个新用户罢了，没有什么神奇的地方。</p>
<h3 id="OpenID"><a href="#OpenID" class="headerlink" title="OpenID"></a>OpenID</h3><p>似乎是一个凉了的东西，做authentication的，那就不管它了</p>
<h3 id="Auth0"><a href="#Auth0" class="headerlink" title="Auth0"></a>Auth0</h3><p>跟着官网的一些指示写了一些东西。</p>
<p><a href="https://auth0.com/" target="_blank" rel="external">https://auth0.com/</a></p>
<p>总的来说，这是一个用户系统的服务吧，把好多做好了，可以直接用，全权管理自己的用户，甚至包括第三方的登录。</p>
<p>集成到自己的app中有点麻烦，没有跟着tutorial走完，大致感觉是Auth0去维护用户，包括authentication和autorization(通过插件的形式)，自己只要来了Auth0的token，Auth0确认下身份和权限然后进行后续的操作就可以了，应该是比较省心的，但也比较黑盒。</p>
<p>如果快速搞一个用户系统的话，或许，这的确是最好的选择，就像介绍视频说的那样。不过，一般的公司都有自己的用户系统，而个人开发的话，或许也没有很严格的用户系统需要，随便能够authentication就可以了，说不定authorization都是假的hh</p>
<h3 id="passport-js"><a href="#passport-js" class="headerlink" title="passport.js"></a>passport.js</h3><blockquote>
<p>Passport is authentication middleware for Node.js.</p>
</blockquote>
<p>所以说，这是更方便的进行authentication</p>
<p>原来需要手动的去做比如用户名+密码审核的工作，它会帮忙更简单的做。<br>原来需要手写OAuth认证流程的，它也有插件帮忙做。</p>
<hr>
<p>以上，疯狂查各种博客，网页的结果，没有经过任何的实践，好多都是自己脑补的。</p>
<p>自己还是对用户系统这一块不是太懂，接下来实践一波，实现一个简易的用户系统，来看看这些东西。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/26/python-matrix-2019-01-26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/26/python-matrix-2019-01-26/" itemprop="url">
                  Python中矩阵的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-26 15:12:08" itemprop="dateCreated datePublished" datetime="2019-01-26T15:12:08+08:00">2019-01-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-27 15:08:44" itemprop="dateModified" datetime="2019-01-27T15:08:44+08:00">2019-01-27</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/26/python-matrix-2019-01-26/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/26/python-matrix-2019-01-26/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在机器学习中，经常会用到矩阵，在python语言中，向量、矩阵等抽象概念如何表示和使用，自己之前一直有些搞不明白，今天就试着总结下吧。</p>
<hr>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>自己需要明确的一些问题：</p>
<ul>
<li>python中list，二维list如何操作</li>
<li>numpy中array，二维array如何操作</li>
<li>python list和numpy array的区别，转化</li>
<li>向量如何表示</li>
<li>矩阵的一些常用操作</li>
<li>向量、矩阵的运算</li>
</ul>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><p>python内置了list，也就是数组，可以用来表示向量和矩阵：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment"># 1-d list</span></div><div class="line">l[:] <span class="comment"># [1, 2, 3]</span></div><div class="line">l[:<span class="number">2</span>] <span class="comment"># [1, 2]</span></div><div class="line">l[<span class="number">1</span>:] <span class="comment"># [2, 3]</span></div><div class="line">l[<span class="number">1</span>] <span class="comment"># [2]</span></div><div class="line">l[<span class="number">-1</span>] <span class="comment"># [3]</span></div><div class="line">l[<span class="number">-2</span>] <span class="comment"># [2]</span></div></pre></td></tr></table></figure>
<p>关于下标，文档里一张图说的很清楚：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> +---+---+---+---+---+---+</div><div class="line"> | P | y | t | h | o | n |</div><div class="line"> +---+---+---+---+---+---+</div><div class="line"> 0   1   2   3   4   5   6</div><div class="line">-6  -5  -4  -3  -2  -1</div></pre></td></tr></table></figure>
<p><strong>2d-list：</strong></p>
<p>表示矩阵可以用python的2维list：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mat = [</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line">]</div><div class="line"></div><div class="line"><span class="comment"># mat</span></div><div class="line"><span class="comment"># [[1, 2, 3], [4, 5, 6]]</span></div></pre></td></tr></table></figure>
<p>表示上呢，python内置的list也就这么回事，具体使用的时候，有一些操作还是值得注意的。<br>关于list所有可以的操作，文档中给出了：<a href="https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range" target="_blank" rel="external">https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range</a><br>（真难找，python的文档咋这么不清楚，把reference和tutorial放在一起的感觉，不喜欢）</p>
<p><code>+</code>和<code>*</code>的操作，就是concat：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">l + l <span class="comment"># [1, 2, 3, 1, 2, 3]</span></div><div class="line">l * <span class="number">3</span> <span class="comment"># [1, 2, 3, 1, 2, 3, 1, 2, 3]</span></div></pre></td></tr></table></figure>
<h2 id="NumPy-Array"><a href="#NumPy-Array" class="headerlink" title="NumPy Array"></a>NumPy Array</h2><p>在机器学习中，好多代码第一行就是<code>import numpy as np</code>哈哈，的确，用numpy的array会更多一些，操作也更丰富一些</p>
<p>ndarray对多维支持很友好，从名字就可以看出来</p>
<h3 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h3><p>常用的有：</p>
<ul>
<li><code>ndim</code></li>
<li><code>shape</code></li>
<li><code>size</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">7</span>]: a = np.array(</div><div class="line">   ...: [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">   ...: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]</div><div class="line">   ...: )</div><div class="line"></div><div class="line">In [<span class="number">8</span>]: a</div><div class="line">Out[<span class="number">8</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">       [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div><div class="line"></div><div class="line">In [<span class="number">9</span>]: a.shape</div><div class="line">Out[<span class="number">9</span>]: (<span class="number">2</span>, <span class="number">3</span>)</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: type(a.shape)</div><div class="line">Out[<span class="number">10</span>]: tuple</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: a.dtype</div><div class="line">Out[<span class="number">11</span>]: dtype(<span class="string">'int64'</span>)</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: a.ndim</div><div class="line">Out[<span class="number">12</span>]: <span class="number">2</span></div><div class="line"></div><div class="line">In [<span class="number">13</span>]: a.size</div><div class="line">Out[<span class="number">13</span>]: <span class="number">6</span></div></pre></td></tr></table></figure>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>直接从list创建：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">16</span>]: np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line">Out[<span class="number">16</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line"></div><div class="line">In [<span class="number">17</span>]: np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div><div class="line">Out[<span class="number">17</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">       [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div><div class="line"></div><div class="line">In [<span class="number">18</span>]: np.array([(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)])</div><div class="line">Out[<span class="number">18</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">       [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div></pre></td></tr></table></figure>
<p>用方便的一些填充函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">22</span>]: np.zeros((<span class="number">2</span>, <span class="number">3</span>))</div><div class="line">Out[<span class="number">22</span>]:</div><div class="line">array([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</div><div class="line">       [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</div><div class="line"></div><div class="line">In [<span class="number">23</span>]: np.zeros(<span class="number">3</span>)</div><div class="line">Out[<span class="number">23</span>]: array([<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>])</div></pre></td></tr></table></figure>
<p>类似的还有<code>np.ones()</code>和<code>np.empty()</code></p>
<p>用<code>np.arange()</code>或者<code>np.linspace()</code>生成一定间隔的数据，其实用的比较少</p>
<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><p>numpy文档：</p>
<blockquote>
<p>Arithmetic operators on arrays apply <em>elementwise</em>. A new array is created and filled with the result.</p>
</blockquote>
<p>所以，一些基本的操作就明确了，比如：<code>*</code>, <code>**</code>等<br>特别要注意是<code>*</code>，并不是矩阵乘法，而是<em>elementwise</em>的乘法</p>
<p><code>sum</code>, <code>min</code>, <code>max</code>:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">9</span>]: a = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: a.sum()</div><div class="line">Out[<span class="number">10</span>]: <span class="number">21</span></div><div class="line"></div><div class="line">In [<span class="number">11</span>]: a.sum(axis=<span class="number">0</span>)</div><div class="line">Out[<span class="number">11</span>]: array([<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>])</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: a.sum(axis=<span class="number">1</span>)</div><div class="line">Out[<span class="number">12</span>]: array([ <span class="number">6</span>, <span class="number">15</span>])</div><div class="line"></div><div class="line">In [<span class="number">13</span>]: a.min(axis=<span class="number">0</span>)</div><div class="line">Out[<span class="number">13</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line"></div><div class="line">In [<span class="number">14</span>]: a.min()</div><div class="line">Out[<span class="number">14</span>]: <span class="number">1</span></div><div class="line"></div><div class="line">In [<span class="number">15</span>]: a.max()</div><div class="line">Out[<span class="number">15</span>]: <span class="number">6</span></div></pre></td></tr></table></figure>
<p>当然也可以用python自己的函数<code>min</code>, <code>max</code>, <code>sum</code>，这其中应该会有一个cast的过程</p>
<h3 id="shape操作"><a href="#shape操作" class="headerlink" title="shape操作"></a>shape操作</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">16</span>]: a</div><div class="line">Out[<span class="number">16</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">       [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div><div class="line"></div><div class="line">In [<span class="number">17</span>]: a.reshape(<span class="number">3</span>, <span class="number">2</span>)</div><div class="line">Out[<span class="number">17</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">4</span>],</div><div class="line">       [<span class="number">5</span>, <span class="number">6</span>]])</div><div class="line">In [<span class="number">20</span>]: a.reshape(<span class="number">3</span>, <span class="number">-1</span>) <span class="comment"># -1表示自动计算</span></div><div class="line">Out[<span class="number">20</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">4</span>],</div><div class="line">       [<span class="number">5</span>, <span class="number">6</span>]])</div><div class="line">       </div><div class="line">In [<span class="number">21</span>]: a.resize(<span class="number">3</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line">In [<span class="number">22</span>]: a</div><div class="line">Out[<span class="number">22</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">4</span>],</div><div class="line">       [<span class="number">5</span>, <span class="number">6</span>]])</div></pre></td></tr></table></figure>
<h3 id="stack-amp-split"><a href="#stack-amp-split" class="headerlink" title="stack &amp; split"></a>stack &amp; split</h3><p><code>hstack</code> <code>vstack</code>：分别水平堆叠和垂直堆叠</p>
<p><code>hsplit</code> <code>vsplit</code>: 分别水平气氛和垂直切分</p>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><ul>
<li>no copy (alias): <code>b = a</code></li>
<li>shallow copy: <code>b = a.view()</code></li>
<li>deep copy: <code>b = a.copy()</code></li>
</ul>
<h3 id="vector-vs-matrix"><a href="#vector-vs-matrix" class="headerlink" title="vector vs. matrix"></a>vector vs. matrix</h3><p>之前自己一直有疑惑的是，numpy中的vector和matrix有什么关系，是不是一样的。<br>因为，在运算的过程中，经常需要矩阵和向量之间进行运算，有时候会有对不齐的操作。</p>
<p>经过了解，明确了，一维数组和矩阵中的行向量或者列向量是不一样的！不能直接进行运算！！</p>
<p>两者的相互转化及运算：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">43</span>]: a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line"></div><div class="line">In [<span class="number">44</span>]: rv = np.array([a]) <span class="comment"># 转换成行向量，(3,) -&gt; (1, 3)</span></div><div class="line"></div><div class="line">In [<span class="number">45</span>]: rv</div><div class="line">Out[<span class="number">45</span>]: array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]])</div><div class="line"></div><div class="line">In [<span class="number">46</span>]: cv = np.vstack(a) <span class="comment"># 转换成列向量，(3,) -&gt; (3, 1)</span></div><div class="line"></div><div class="line">In [<span class="number">47</span>]: cv</div><div class="line">Out[<span class="number">47</span>]:</div><div class="line">array([[<span class="number">1</span>],</div><div class="line">       [<span class="number">2</span>],</div><div class="line">       [<span class="number">3</span>]])</div><div class="line"></div><div class="line">In [<span class="number">48</span>]: cv @ rv</div><div class="line">Out[<span class="number">48</span>]:</div><div class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>]])</div><div class="line"></div><div class="line">In [<span class="number">52</span>]: rv[<span class="number">0</span>] <span class="comment"># 行向量 -&gt; array</span></div><div class="line">Out[<span class="number">52</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line"></div><div class="line">In [<span class="number">53</span>]: cv[:, <span class="number">0</span>] <span class="comment"># 列向量 -&gt; array</span></div><div class="line">Out[<span class="number">53</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>用NumPy的array，会比自带的强大很多！</p>
<p>一维array和矩阵中的行向量和列向量不一样！</p>
<p>NumPy的文档还是很清晰的，有问题找文档！（Python的文档是真的辣鸡呀~）</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/20/NA_LAB-2019-01-20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/20/NA_LAB-2019-01-20/" itemprop="url">
                  NA(Numerical Analysis) Lab总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-20 13:46:12" itemprop="dateCreated datePublished" datetime="2019-01-20T13:46:12+08:00">2019-01-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-21 01:10:13" itemprop="dateModified" datetime="2019-01-21T01:10:13+08:00">2019-01-21</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Math/" itemprop="url" rel="index"><span itemprop="name">Math</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Math/Numerical-Analysis/" itemprop="url" rel="index"><span itemprop="name">Numerical Analysis</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/20/NA_LAB-2019-01-20/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/20/NA_LAB-2019-01-20/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>数值分析的8个LAB做完了，这八道题，可以说是自己做过的课程里边最难的作业了，最难但并不玄学！值得记下来，来纪念自己在这八道题上花费的时间和精力！</p>
<p>这八道题似乎很多年没有变过了，所以，说不定对之后的学弟学妹估计有些帮助吧~</p>
<hr>
<h2 id="Q1-Numerical-Summation-of-a-Series"><a href="#Q1-Numerical-Summation-of-a-Series" class="headerlink" title="Q1. Numerical Summation of a Series"></a>Q1. Numerical Summation of a Series</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p><strong>6-1 Numerical Summation of a Series （30 分）</strong></p>
<p>Produce a table of the values of the series</p>
<script type="math/tex; mode=display">\phi(x) = \sum_{k = 1}^{\infty} \frac{1}{k(k+x)} ......(1)</script><p>for the 3001 values of x, x = 0.0, 0.1, 0.2, …, 300.00. All entries of the table must have an absolute error less than $10^{-10}$. This problem is based on a problem from Hamming (1962), when mainframes were very slow by today’s microcomputer standards.</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Series_Sum</span><span class="params">( <span class="keyword">double</span> sum[] )</span></span>;</div></pre></td></tr></table></figure>
<p>where <code>double sum[]</code> is an array of 3001 entries, each contains a value of $\phi(x)$ for x = 0.0, 0.1, 0.2, …, 300.00.</p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Series_Sum</span><span class="params">( <span class="keyword">double</span> sum[] )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">double</span> x, sum[<span class="number">3001</span>];</div><div class="line">	</div><div class="line">    Series_Sum( sum );</div><div class="line"></div><div class="line">    x = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">3001</span>; i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%6.2f %16.12f\n"</span>, x + (<span class="keyword">double</span>)i * <span class="number">0.10</span>, sum[i]);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your function will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">0.00   1.644934066848</div><div class="line">0.10   1.534607244904</div><div class="line">...</div><div class="line">1.00   1.000000000000</div><div class="line">...</div><div class="line">2.00   0.750000000000</div><div class="line">...</div><div class="line">300.00   0.020942212934</div></pre></td></tr></table></figure>
<p><strong>Hint:</strong></p>
<p>The problem with summing the sequence in equation (1) is that too many terms may be required to complete the summation in the given time. Additionally, if enough terms were to be summed, roundoff would render any typical double precision computation useless for the desired precision.</p>
<p>To improve the convergence of the summation process note that:</p>
<script type="math/tex; mode=display">\frac{1}{k(k+1)} = \frac{1}{k} - \frac{1}{k + 1} ......(2)</script><p>which implies $\phi(1)=1.0$. One can then produce a series for $\phi(x) - \phi(1)$ which converges faster than the original series. This series not only converges much faster, it also reduces roundoff loss.</p>
<p>This process of finding a faster converging series may be repeated again on the second series to produce a third sequence, which converges even more rapidly than the second.</p>
<p>The following equation is helpful in determining how may items are required in summing the series above.</p>
<script type="math/tex; mode=display">\sum_{k = n}^{\infty}\frac{1}{k^r} < \int_{n - 1}^{\infty} \frac{1}{x^r}dx (k > 1, r > 1) ......(3)</script><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>先求1，2，…，300的值，整数的值公式比较直观，可以直接求得</p>
<p>按照提示上的方法，推导出递推公式，即用另外几个数的值来表示当前位置的值，比较复杂，也比较有趣</p>
<p>对于在[i, i + 1]区间内的小数，用递推公式运用后几个整数的值求得，我用的是i+1, i+2, i+3, i+4四个数</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li>边界条件，如果用当前数的后四个数，到了297的时候，就不能继续向后走了，我选择的是297，298，299，300四个数来计算这个区间的数</li>
<li>注意C语言中乘法的int型和double型，尽管很注意，但是自己还是犯了错误</li>
</ol>
<h3 id="点评"><a href="#点评" class="headerlink" title="点评"></a>点评</h3><p>应该是最难也是最有意思的一道题了，这样的题让人做的很有感觉！</p>
<p>推导公式还是挺痛苦的，思路理不清，大概用了三个时间段，总共五六个小时吧，所以一开始做的时候不要怀疑自己而去网上找答案，自己推，推出来之后还是很有成就感的！</p>
<h2 id="Q2-Root-of-a-Polynomial"><a href="#Q2-Root-of-a-Polynomial" class="headerlink" title="Q2. Root of a Polynomial"></a>Q2. Root of a Polynomial</h2><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p><strong>6-2 Root of a Polynomial （40 分）</strong></p>
<p>A polynomial of degree n has the common form as p(x)=c, $p(x) = c<em>nx^n + c</em>{n - 1}x^{n - 1} + \dots + c_1x + c_0$ . Your task is to write a function to find a root of a given polynomial in a given interval.</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Polynomial_Root</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> c[], <span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> EPS)</span></span>;</div></pre></td></tr></table></figure>
<p>where <code>int n</code> is the degree of the polynomial; <code>double c[]</code> is an array of n+1 coefficients $c<em>n, c</em>{n - 1}, …, c_1$ and $c_0$ of the given polynomial; <code>double a</code> and <code>b</code> are the two end-points of the given interval; and <code>double EPS</code> is the accuracy of the root.</p>
<p>The function must return the root.</p>
<p><strong>Note:</strong> <em>It is guaranteed that a unique real number r exists in the given interval such that $p(r)=0$.</em></p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO 1e-13 <span class="comment">/* X is considered to be 0 if |X|&lt;ZERO */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 11    <span class="comment">/* Max Polynomial Degree + 1 */</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">Polynomial_Root</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> c[], <span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> EPS)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">double</span> c[MAXN], a, b;</div><div class="line">    <span class="keyword">double</span> EPS = <span class="number">0.00005</span>;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">for</span> (i=n; i&gt;=<span class="number">0</span>; i--) </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;c[i]);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;a, &amp;b);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%.4f\n"</span>, Polynomial_Root(n, c, a, b, EPS));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your function will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Input:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2 1 1.5 -1</div><div class="line">0 2</div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0.5000</div></pre></td></tr></table></figure>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>算法用Modified-Newton是可以的</p>
<p>需要求1阶和2阶导数，不过多项式求导很简单</p>
<p>初始点自己定，为了保证收敛，可以将给定的区间分成N等份，逐个试验是不是满足条件，我分的是100份</p>
<h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>这道题需要注意的地方还挺多的</p>
<ol>
<li>考虑分母为0的情况，如果分母为0，就可以认为不符合，直接取下一个初值重新来</li>
<li>考虑-0的情况，这应该是OJ的问题了，不过，自己稍微加一下没啥</li>
<li>初始点的选择，不能随便取一个或者几个，可以取几十个几百个，我取100个迭代也没有超时</li>
</ol>
<h3 id="点评-1"><a href="#点评-1" class="headerlink" title="点评"></a>点评</h3><p>坑的地方挺多的，自己也花了挺多的时间</p>
<p>还有，modified-newton method，真的很不明显，一开始在PPT和课本上都没有找到，复习的时候再课本的某段文字里发现了，不过可能modified-newton本来就不是一个专有名词吧</p>
<h2 id="Q3-There-is-No-Free-Lunch"><a href="#Q3-There-is-No-Free-Lunch" class="headerlink" title="Q3. There is No Free Lunch"></a>Q3. There is No Free Lunch</h2><h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><p><strong>6-3 There is No Free Lunch （40 分）</strong></p>
<p>One day, CYLL found an interesting piece of commercial from newspaper: the Cyber-restaurant was offering a kind of “Lunch Special” which was said that one could “buy one get two for free”. That is, if you buy one of the dishes on their menu, denoted by $d<em>i$ with price $p_i$, you may get the two neighboring dishes $d</em>{i - 1}$ and $d<em>{i+1}$ for free! If you pick up $d_1$, then you may get $d_2$ and the last one $d_n$ for free, and if you choose the last one $d_n$, you may get $d</em>{n - 1}$ and $d_1$ for free.</p>
<p>However, after investigation CYLL realized that there was no free lunch at all. The price $p_i$ of the i-th dish was actually calculated by adding up twice the cost $c_i$ of the dish and half of the costs of the two “free” dishes. Now given all the prices on the menu, you are asked to help CYLL find the cost of each of the dishes.</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Price</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> p[] )</span></span>;</div></pre></td></tr></table></figure>
<p>where <code>int n</code> satisfies that 2&lt; <code>n</code> ≤10000; <code>double p[]</code> is passed into the function as an array of prices $p_i$ and then will be returned storing the costs of the dishes.</p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Max_size 10000 <span class="comment">/* max number of dishes */</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Price</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> p[] )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n, i;</div><div class="line">    <span class="keyword">double</span> p[Max_size];</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;n; i++) </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;p[i]);</div><div class="line">    Price(n, p);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.2f "</span>, p[i]);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your function will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Input:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">12 23.64 17.39 12.77 16.62 10.67 14.85 12.68 26.90 28.30 15.59 37.99 23.18</div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">9.20 5.58 3.24 7.00 1.99 6.36 2.25 10.01 11.52 0.50 17.65 4.88</div></pre></td></tr></table></figure>
<h3 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3><p>由题意不难得出一个方程组，其系数矩阵很有特征</p>
<p>自己知道有两种思路：</p>
<p>一种是对最后一行和第一行做处理，其它的都是一个完美的三对角矩阵，这样就可以比较轻松的解出来</p>
<p>另一种是直接用Jacobi迭代或者Gauss-Siedel迭代解方程</p>
<p>题目的本意我想肯定是前者，但是我用的后者，因为简单粗暴</p>
<h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><p>一个特别需要注意的地方，如果用迭代法做，自己想开一个二维数组存系数矩阵，并不可以，这道题的<code>Max_size</code>给的很大，会直接段错误，我估计case里边也有很大的系数矩阵，就算动态分配估计也不可以吧..<br>不过由于这个矩阵比较特殊，主对角线上的值就是最大的，而且每行的和相同，所以可以轻松的推出Jacobi迭代中自己需要的信息，而且写起来更简单</p>
<h3 id="点评-2"><a href="#点评-2" class="headerlink" title="点评"></a>点评</h3><p>好吧，用了简单粗暴的方式解决了本来还需要推导一番的问题，如果先做了第四题，那么这道题应该很容易了hh</p>
<h2 id="Q4-Compare-Methods-of-Jacobi-with-Gauss-Seidel"><a href="#Q4-Compare-Methods-of-Jacobi-with-Gauss-Seidel" class="headerlink" title="Q4. Compare Methods of Jacobi with Gauss-Seidel"></a>Q4. Compare Methods of Jacobi with Gauss-Seidel</h2><h3 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h3><p><strong>6-4 Compare Methods of Jacobi with Gauss-Seidel （30 分）</strong></p>
<p>Use Jacobi and Gauss-Seidel methods to solve a given $n\times n$ linear system $A\vec{x} = \vec{b}$ with an initial approximation $\vec{x^0}$<br>Note: When checking each $a<em>{ii}$, first scan downward for the entry with maximum absolute value ($a</em>{ii}$ included). If that entry is non-zero, swap it to the diagonal. Otherwise if that entry is zero, scan upward for the entry with maximum absolute value. If that entry is non-zero, then add that row to the i-th row.</p>
<p><strong>Format of functions:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Jacobi</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> b[], <span class="keyword">double</span> x[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Gauss_Seidel</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> b[], <span class="keyword">double</span> x[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN )</span></span>;</div></pre></td></tr></table></figure>
<p>where <code>int n</code> is the size of the matrix of which the entries are in the array <code>double a[][MAX_SIZE]</code> and <code>MAX_SIZE</code> is a constant defined by the judge; <code>double b[]</code> is for $\vec{b}$, <code>double x[]</code> passes in the initial approximation $\vec{x^0}$ and return the solution $\vec{x}$; double <code>TOL</code> is the tolerance for $\lVert \vec{x^{k+1}} - \vec{x^k} \rVert$; and finally <code>int MAXN</code> is the maximum number of iterations.</p>
<p>The function must return:</p>
<ul>
<li>k if there is a solution found after k iterations;</li>
<li>0 if maximum number of iterations exceeded;</li>
<li>1 if the matrix has a zero column and hence no unique solution exists;</li>
<li>2 if there is no convergence, that is, there is an entry of $\vec{x^K}$that is out of the range <code>[-bound, bound]</code> where <code>bound</code> is a constant defined by the judge.</li>
</ul>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> bound pow(2, 127)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO 1e-9 <span class="comment">/* X is considered to be 0 if |X|&lt;ZERO */</span></span></div><div class="line"></div><div class="line"><span class="keyword">enum</span> <span class="keyword">bool</span> &#123; <span class="literal">false</span> = <span class="number">0</span>, <span class="literal">true</span> = <span class="number">1</span> &#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> bool enum bool</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Jacobi</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> b[], <span class="keyword">double</span> x[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Gauss_Seidel</span><span class="params">( <span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> b[], <span class="keyword">double</span> x[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n, MAXN, i, j, k;</div><div class="line">    <span class="keyword">double</span> a[MAX_SIZE][MAX_SIZE], b[MAX_SIZE], x[MAX_SIZE];</div><div class="line">    <span class="keyword">double</span> TOL;</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;n; j++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;a[i][j]);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;b[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf %d"</span>, &amp;TOL, &amp;MAXN);</div><div class="line"></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Result of Jacobi method:\n"</span>);</div><div class="line">    <span class="keyword">for</span> ( i=<span class="number">0</span>; i&lt;n; i++ )</div><div class="line">        x[i] = <span class="number">0.0</span>;</div><div class="line">    k = Jacobi( n, a, b, x, TOL, MAXN );</div><div class="line">    <span class="keyword">switch</span> ( k ) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"No convergence.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">-1</span>: </div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Matrix has a zero column.  No unique solution exists.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Maximum number of iterations exceeded.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"no_iteration = %d\n"</span>, k);</div><div class="line">            <span class="keyword">for</span> ( j=<span class="number">0</span>; j&lt;n; j++ )</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%.8f\n"</span>, x[j]);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Result of Gauss-Seidel method:\n"</span>);</div><div class="line">    <span class="keyword">for</span> ( i=<span class="number">0</span>; i&lt;n; i++ )</div><div class="line">        x[i] = <span class="number">0.0</span>;</div><div class="line">    k = Gauss_Seidel( n, a, b, x, TOL, MAXN );</div><div class="line">    <span class="keyword">switch</span> ( k ) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"No convergence.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">-1</span>: </div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Matrix has a zero column.  No unique solution exists.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Maximum number of iterations exceeded.\n"</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"no_iteration = %d\n"</span>, k);</div><div class="line">            <span class="keyword">for</span> ( j=<span class="number">0</span>; j&lt;n; j++ )</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%.8f\n"</span>, x[j]);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your function will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Input 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">2	-1	1	-1</div><div class="line">2	2	2	4</div><div class="line">-1	-1	2	-5</div><div class="line">0.000000001 1000</div></pre></td></tr></table></figure>
<p><strong>Sample Output 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Result of Jacobi method:</div><div class="line">No convergence.</div><div class="line">Result of Gauss-Seidel method:</div><div class="line">no_iteration = 37</div><div class="line">1.00000000</div><div class="line">2.00000000</div><div class="line">-1.00000000</div></pre></td></tr></table></figure>
<p><strong>Sample Input 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">1	2	-2	7</div><div class="line">1	1	1	2</div><div class="line">2	2	1	5</div><div class="line">0.000000001 1000</div></pre></td></tr></table></figure>
<p><strong>Sample Output 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Result of Jacobi method:</div><div class="line">no_iteration = 232</div><div class="line">1.00000000</div><div class="line">2.00000000</div><div class="line">-1.00000000</div><div class="line">Result of Gauss-Seidel method:</div><div class="line">No convergence.</div></pre></td></tr></table></figure>
<p><strong>Sample Input 3:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">5</div><div class="line">2 1 0 0 0 1</div><div class="line">1 2 1 0 0 1</div><div class="line">0 1 2 1 0 1</div><div class="line">0 0 1 2 1 1</div><div class="line">0 0 0 1 2 1</div><div class="line">0.000000001 100</div></pre></td></tr></table></figure>
<p><strong>Sample Output 3:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Result of Jacobi method:</div><div class="line">Maximum number of iterations exceeded.</div><div class="line">Result of Gauss-Seidel method:</div><div class="line">no_iteration = 65</div><div class="line">0.50000000</div><div class="line">0.00000000</div><div class="line">0.50000000</div><div class="line">0.00000000</div><div class="line">0.50000000</div></pre></td></tr></table></figure>
<h3 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h3><p>思路很清晰，两个算法也都给出了，就是把它实现一遍</p>
<p>课本上原模原样的算法抄上去就可以了</p>
<p>注意需要在之前按照题意对矩阵进行调整</p>
<h3 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h3><p>由于自己一遍过了，所以觉得没啥需要注意的，调整矩阵，题目中也提示到了</p>
<h3 id="点评-3"><a href="#点评-3" class="headerlink" title="点评"></a>点评</h3><p>第一道做出的题目，抄算法，所以觉得这道题没啥..</p>
<h2 id="Q5-Approximating-Eigenvalues"><a href="#Q5-Approximating-Eigenvalues" class="headerlink" title="Q5. Approximating Eigenvalues"></a>Q5. Approximating Eigenvalues</h2><h3 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h3><p><strong>6-5 Approximating Eigenvalues （40 分）</strong></p>
<p>Approximate an eigenvalue and an associated eigenvector of $a$ given $n \times n$ matrix $A$ near $a$ given value $p$ and a nonzero vector $<br>\vec{x} = (x_1, \dots, x_n)^T$</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">EigenV</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> *lambda, <span class="keyword">double</span> v[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN)</span></span>;</div></pre></td></tr></table></figure>
<p>where <code>int</code> is the size of the matrix of which the entries are in the array <code>double a[][MAX_SIZE]</code> and <code>MAX_SIZE</code> is a constant defined by the judge; <code>double *lambda</code> is passed into the function as an initial approximation $p$ of the eigenvalue and is supposed to be returned as a more accurate eigenvalue; <code>double v[]</code> is passed into the function as the initial vector $\vec{x}$ and is supposed to be returned as the associated eigenvector with unit $\lVert \cdot \rVert$ norm; <code>double TOL</code> is the tolerance for the eigenvalue; and finally <code>int MAXN</code> is the maximum number of iterations.</p>
<p>The function must return:</p>
<ul>
<li>1 if there is a solution;</li>
<li>0 if maximum number of iterations exceeded;</li>
<li>−1 if p is just the accurate eigenvalue.</li>
</ul>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">EigenV</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> a[][MAX_SIZE], <span class="keyword">double</span> *lambda, <span class="keyword">double</span> v[], <span class="keyword">double</span> TOL, <span class="keyword">int</span> MAXN)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n, MAXN, m, i, j, k;</div><div class="line">    <span class="keyword">double</span> a[MAX_SIZE][MAX_SIZE], v[MAX_SIZE];</div><div class="line">    <span class="keyword">double</span> lambda, TOL;</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;n; i++) </div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;n; j++) </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;a[i][j]);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf %d"</span>, &amp;TOL, &amp;MAXN);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;m; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;lambda);</div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;n; j++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;v[j]);</div><div class="line">        <span class="keyword">switch</span> (EigenV(n, a, &amp;lambda, v, TOL, MAXN)) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">-1</span>: </div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%12.8f is an eigenvalue.\n"</span>, lambda );</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"Maximum number of iterations exceeded.\n"</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%12.8f\n"</span>, lambda );</div><div class="line">                <span class="keyword">for</span> (k=<span class="number">0</span>; k&lt;n; k++)</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%12.8f "</span>, v[k]);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your function will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Input 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">1 2 3</div><div class="line">2 3 4</div><div class="line">3 4 5</div><div class="line">0.0000000001 1000</div><div class="line">1</div><div class="line">-0.6 1 1 1</div></pre></td></tr></table></figure>
<p><strong>Sample Output 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-0.62347538</div><div class="line">  1.00000000   0.17206558  -0.65586885</div></pre></td></tr></table></figure>
<p><strong>Sample Input 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">0 1</div><div class="line">1 0</div><div class="line">0.0000000001 10</div><div class="line">2</div><div class="line">1.0 1 1</div><div class="line">100.0 1 0</div></pre></td></tr></table></figure>
<p><strong>Sample Output 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  1.00000000 is an eigenvalue.</div><div class="line">Maximum number of iterations exceeded.</div></pre></td></tr></table></figure>
<h3 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h3><p>近似特征值的算法用反幂法是可以的</p>
<p>我按照书上的算法走的</p>
<p>书上的算法Step1是给p赋值，本题目中给定了初值，直接用它就可以</p>
<p>需要解线性方程组，直接解似乎会超时，需要做一个LU Factorization然后之后的每次计算用L和U矩阵而不是原始的A矩阵，如果LU factorization做不下去，那就是题目中说的给定值就是初始值了</p>
<h3 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h3><p>有两个需要注意的地方</p>
<ol>
<li>不要改掉原来的系数矩阵，因为每次迭代解方程的系数矩阵需要在原矩阵对角线上减去<code>lambda</code>，要在原来的矩阵上减，而不是一直减下去</li>
<li>课本上的算法有坑！至少英文版第七版上是不对的，Step8：$\mu = y_p$，而新的$p$是在Step9算的，所以Step8应该在Step9之后！</li>
</ol>
<h3 id="点评-4"><a href="#点评-4" class="headerlink" title="点评"></a>点评</h3><p>虽然这两个坑好像很多人踩，但我都没有踩到，也算是比较幸运的吧</p>
<p>代码量还是挺大的，比较烦，需要LU分解和解方程，不过都有算法，自己想想也不复杂</p>
<h2 id="Q6-Cubic-Spline"><a href="#Q6-Cubic-Spline" class="headerlink" title="Q6. Cubic Spline"></a>Q6. Cubic Spline</h2><h3 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h3><p><strong>6-6 Cubic Spline （40 分）</strong></p>
<p>Construct the cubic spline interpolant $S$ for the function $f$, defined at points $x_0 &lt; x_1 &lt; \dots &lt; x_n$, satisfying some given boundary conditions. Partition a given interval into $m$ equal-length subintervals, and approximate the function values at the endpoints of these subintervals.</p>
<p><strong>Format of functions:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cubic_Spline</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> x[], <span class="keyword">double</span> f[], <span class="keyword">int</span> Type, <span class="keyword">double</span> s0, <span class="keyword">double</span> sn, <span class="keyword">double</span> a[], <span class="keyword">double</span> b[], <span class="keyword">double</span> c[], <span class="keyword">double</span> d[])</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">S</span><span class="params">( <span class="keyword">double</span> t, <span class="keyword">double</span> Fmax, <span class="keyword">int</span> n, <span class="keyword">double</span> x[], <span class="keyword">double</span> a[], <span class="keyword">double</span> b[], <span class="keyword">double</span> c[], <span class="keyword">double</span> d[] )</span></span>;</div></pre></td></tr></table></figure>
<p>The function <code>Cubic_Spline</code> is for calculating the set of coefficients of<br>$S(x)$ where $S(x) = S^{[j]}(x) = a<em>j + b_j(x - x</em>{j - 1}) + c<em>j(x - x</em>{j - 1})^2 + d<em>j(x - x</em>{j - 2})^3$. The function <code>S</code> is for obtaining an approximation of $f(t)$ using the spline function $S(t)$. The parameters are defined as the following:</p>
<p><code>int n</code> is the number of interpolating points−1;<br><code>double x[]</code> contains n+1 distinct real numbers $x_0 &lt; x_1 &lt; \dots &lt; x_n$;<br><code>double f[]</code> contains n+1 real numbers $f(x_0), f(x_1), \dots ,f(x_n)$;<br><code>int Type</code> is the type of boundary conditions, where 1 corresponds to the clamped boundary condition $S’(x_0) = s_0, S’(x_n) = s_n$ and 2 corresponds to the natural boundary condition $S’’(x_0) = s_0, S’’(x_n) = s_n$;<br><code>double s0</code> and <code>double sn</code> are $s_0$ and $s_n$ respectively;<br><code>double a[]</code>, <code>b[]</code>, <code>c[]</code>, and <code>d[]</code> contain the set of coefficients of $S(x)$;<br><code>double t</code> is an endpoint of a subinterval;</p>
<p>and finally <code>double Fmax</code> is the default value that $S(t)$ will assume if t is out of the range $[x_0, x_n]$</p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cubic_Spline</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> x[], <span class="keyword">double</span> f[], <span class="keyword">int</span> Type, <span class="keyword">double</span> s0, <span class="keyword">double</span> sn, <span class="keyword">double</span> a[], <span class="keyword">double</span> b[], <span class="keyword">double</span> c[], <span class="keyword">double</span> d[])</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">S</span><span class="params">( <span class="keyword">double</span> t, <span class="keyword">double</span> Fmax, <span class="keyword">int</span> n, <span class="keyword">double</span> x[], <span class="keyword">double</span> a[], <span class="keyword">double</span> b[], <span class="keyword">double</span> c[], <span class="keyword">double</span> d[] )</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n, Type, m, i;</div><div class="line">    <span class="keyword">double</span> x[MAX_N], f[MAX_N], a[MAX_N], b[MAX_N], c[MAX_N], d[MAX_N];</div><div class="line">    <span class="keyword">double</span> s0, sn, Fmax, t0, tm, h, t;</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;=n; i++) </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;x[i]);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;=n; i++) </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;f[i]);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %lf %lf %lf"</span>, &amp;Type, &amp;s0, &amp;sn, &amp;Fmax);</div><div class="line"></div><div class="line">    Cubic_Spline(n, x, f, Type, s0, sn, a, b, c, d);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%12.8e %12.8e %12.8e %12.8e \n"</span>, a[i], b[i], c[i], d[i]);</div><div class="line"></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf %lf %d"</span>, &amp;t0, &amp;tm, &amp;m);</div><div class="line">    h = (tm-t0)/(<span class="keyword">double</span>)m;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;=m; i++) &#123;</div><div class="line">        t = t0+h*(<span class="keyword">double</span>)i;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"f(%12.8e) = %12.8e\n"</span>, t, S(t, Fmax, n, x, a, b, c, d));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Your functions will be put here */</span></div></pre></td></tr></table></figure>
<p><strong>Sample Input:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">0.0 1.0 2.0</div><div class="line">0.0 1.0 2.0</div><div class="line">1 1.0 1.0 0.0</div><div class="line">0.0 3.0 2</div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">0.00000000e+00 1.00000000e+00 0.00000000e+00 0.00000000e+00 </div><div class="line">1.00000000e+00 1.00000000e+00 0.00000000e+00 0.00000000e+00 </div><div class="line">f(0.00000000e+00) = 0.00000000e+00</div><div class="line">f(1.50000000e+00) = 1.50000000e+00</div><div class="line">f(3.00000000e+00) = 0.00000000e+00</div></pre></td></tr></table></figure>
<h3 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h3><p>算法名称已经告诉了，书上也有现成的算法</p>
<p>有一个区别在于，本题目的Natural Cubic Spline并不是两端的二阶导为0，而是等于s0和sn. 这个需要对原算法做出一定的调整，其实就是推导出来的系数矩阵中的系数和右侧的首尾的值改一下就可以了..</p>
<h3 id="注意-5"><a href="#注意-5" class="headerlink" title="注意"></a>注意</h3><p>很坑的一点，很容易忽视的一点！！</p>
<p>如果发现自己总是2、3点过不了，有时候不一定是Spline算法的问题，而是自己写的S函数有问题！！我当时2、3点过不了，就是S函数的问题，注意区间、边界值之类的，反正多试几次应该就有了~</p>
<h3 id="点评-5"><a href="#点评-5" class="headerlink" title="点评"></a>点评</h3><p>唉，最后两个点，死活过不了，提交次数最多的一道题了！！</p>
<p>没想到啊没想到，竟然是<code>S</code>的问题而不是算法的问题，气死我了！！</p>
<h2 id="Q7-Orthogonal-Polynomials-Approximation"><a href="#Q7-Orthogonal-Polynomials-Approximation" class="headerlink" title="Q7. Orthogonal Polynomials Approximation"></a>Q7. Orthogonal Polynomials Approximation</h2><h3 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h3><p><strong>6-7 Orthogonal Polynomials Approximation （40 分）</strong></p>
<p>Given a function $f$ and a set of $m&gt;0$ distinct points $x<em>1 &lt; x_2 &lt; \dots &lt; x_m$. You are supposed to write a function to approximate $f$ by an orthogonal polynomial using the exact function values at the given m points with a weight $w(x_i)$ assigned to each point $x_i$. The total error $err =<br>sum</em>{i=1}^{m}w(x_i)|f(x_i) - P_n(x_i)|^2$ must be no larger than a given tolerance.</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int OPA( double (*f)(double t), int m, double x[], double w[], double c[], double *eps );</div></pre></td></tr></table></figure>
<p>where the function pointer <code>double (*f)(double t)</code> defines the function $f$; <code>int m</code> is the number of points; <code>double x[]</code> contains points $x_1 &lt; x_2 &lt; \dots &lt; x_m$; <code>double w[]</code> contains the values of a weight function at the given points <code>x[]</code>; <code>double c[]</code> contains the coefficients $c_1 &lt; c_2 &lt; \dots &lt; c_m$ of the approximation polynomial $P_n(x) = c_0 + c_1x + \dots + c_nx^n$; <code>double *eps</code> is passed into the function as the tolerance for the error, and is supposed to be returned as the value of error. The function <code>OPA</code> is supposed to return the degree of the approximation polynomial.</p>
<p>Note: a constant <code>Max_n</code> is defined so that if the total error is still not small enough when n = <code>Max_n</code>, simply output the result obtained when n = <code>Max_n</code>.</p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;math.h&gt;</div><div class="line"></div><div class="line">#define MAX_m 200</div><div class="line">#define MAX_n 5</div><div class="line"></div><div class="line">double f1(double x)</div><div class="line">&#123;</div><div class="line">    return sin(x);</div><div class="line">&#125;</div><div class="line"></div><div class="line">double f2(double x)</div><div class="line">&#123;</div><div class="line">    return exp(x);</div><div class="line">&#125;</div><div class="line"></div><div class="line">int OPA( double (*f)(double t), int m, double x[], double w[], double c[], double *eps );</div><div class="line"></div><div class="line">void print_results( int n, double c[], double eps)</div><div class="line">&#123;	</div><div class="line">    int i;</div><div class="line"></div><div class="line">    printf("%d\n", n);</div><div class="line">    for (i=0; i&lt;=n; i++)</div><div class="line">        printf("%12.4e ", c[i]);</div><div class="line">    printf("\n");</div><div class="line">    printf("error = %9.2e\n", eps);</div><div class="line">    printf("\n");</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    int m, i, n;</div><div class="line">    double x[MAX_m], w[MAX_m], c[MAX_n+1], eps;</div><div class="line"></div><div class="line">    m = 90;</div><div class="line">    for (i=0; i&lt;m; i++) &#123;</div><div class="line">        x[i] = 3.1415926535897932 * (double)(i+1) / 180.0;</div><div class="line">        w[i] = 1.0;</div><div class="line">    &#125;</div><div class="line">    eps = 0.001;</div><div class="line">    n = OPA(f1, m, x, w, c, &amp;eps);</div><div class="line">    print_results(n, c, eps);</div><div class="line"></div><div class="line">    m = 200;</div><div class="line">    for (i=0; i&lt;m; i++) &#123;</div><div class="line">        x[i] = 0.01*(double)i;</div><div class="line">        w[i] = 1.0;</div><div class="line">    &#125;</div><div class="line">    eps = 0.001;</div><div class="line">    n = OPA(f2, m, x, w, c, &amp;eps);</div><div class="line">    print_results(n, c, eps);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* Your function will be put here */</div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line"> -2.5301e-03   1.0287e+00  -7.2279e-02  -1.1287e-01 </div><div class="line">error =  6.33e-05</div><div class="line"></div><div class="line">4</div><div class="line">  1.0025e+00   9.6180e-01   6.2900e-01   7.0907e-03   1.1792e-01 </div><div class="line">error =  1.62e-04</div></pre></td></tr></table></figure>
<h3 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h3><p>算法的话，按照PPT上的算法即可，不需要做太大的改动，注意需要求内积，自己写个内积函数</p>
<h3 id="注意-6"><a href="#注意-6" class="headerlink" title="注意"></a>注意</h3><p>很需要注意的一点，就是题目要求的是标准系数，而不是算法求出来每个项的系数，这是很需要注意的！！</p>
<p>当你算出来error是一样的，但是系数全部不一样的时候，绝大多数都是这个错误！</p>
<h3 id="点评-6"><a href="#点评-6" class="headerlink" title="点评"></a>点评</h3><p>课本上没有这个算法，自己搞懂原理之后，写出来一个，样例是可以过的，但是总是有些点过不了，改用PPT的算法就过了，差不多都是一样的，除了error的计算，它是一步步减的，我是最后算的，可是本质上是一样的，唉，不知道为什么，不过AC了，就不去想它了。</p>
<h2 id="Q8-Shape-Roof"><a href="#Q8-Shape-Roof" class="headerlink" title="Q8. Shape Roof"></a>Q8. Shape Roof</h2><h3 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h3><p><strong>6-8 Shape Roof （40 分）</strong></p>
<p>The kind of roof shown in Figure 1 is shaped from plain flat rectangular plastic board in Figure 2.</p>
<p><img src="/media/15480024845015.jpg" alt=""><br>Figure 1</p>
<p><img src="/media/15480024943979.jpg" alt=""><br>Figure 2</p>
<p>The transection of the roof is a sine curve which fits the function $y(x)=lsin(lx)$ in centimeters. Given the length of the roof, your task is to calculate the length of the flat board needed to shape the roof.</p>
<p><strong>Format of function:</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">double Integral(double a, double b, double (*f)(double x, double y, double z), double eps, double l, double t);</div></pre></td></tr></table></figure>
<p>where the function <code>Integral</code> returns the value of a definit integral of a given function pointed by <code>f</code> over a given interval from <code>double a</code> to <code>double b</code>. The integrant function <code>f</code> will be defined in the sample program of judge. Other parameters are: <code>double eps</code>, the accuracy of the resulting value of the integral; <code>double l</code> and <code>double t</code>, the altitude and the frequency of the sine curve, respectively.</p>
<p>Note: the length of the flat board which <code>Integral</code> returns must be in meters.</p>
<p><strong>Sample program of judge:</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;math.h&gt;</div><div class="line"></div><div class="line">double f0( double x, double l, double t )</div><div class="line">&#123;</div><div class="line">    return sqrt(1.0+l*l*t*t*cos(t*x)*cos(t*x));</div><div class="line">&#125;</div><div class="line"></div><div class="line">double Integral(double a, double b, double (*f)(double x, double y, double z), </div><div class="line">double eps, double l, double t);</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    double a=0.0, b, eps=0.005, l, t;</div><div class="line"></div><div class="line">    scanf("%lf %lf %lf", &amp;l, &amp;b, &amp;t);</div><div class="line">    printf("%.2f\n", Integral(a, b, f0, eps, l, t));</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* Your function will be put here */</div></pre></td></tr></table></figure>
<p><strong>Sample Input:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2 100 1</div></pre></td></tr></table></figure>
<p><strong>Sample Output:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1.68</div></pre></td></tr></table></figure>
<h3 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h3><p>就是一个积分，甚至积分公式的函数都给出来了，直接代入值就可以了</p>
<p>分成足够多的小段，矩形累加起来是可以过的</p>
<h3 id="注意-7"><a href="#注意-7" class="headerlink" title="注意"></a>注意</h3><p>没啥注意的，试几次总会过得</p>
<h3 id="点评-7"><a href="#点评-7" class="headerlink" title="点评"></a>点评</h3><p>笑死我了，题目本意肯定不是这样，不过，反正，四行代码，过了，就那样了，可能是今年的case要求不是很高吧，分了4000000段，都没有超时~</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>八道题，除了第一道觉得很有意思之外，其它的基本上都有现成的算法，所以做过之后觉得还好..</p>
<p>感觉这种小数点后十几位的要求，有一定的玄学因素在里边，可能同样的算法，步骤顺序不同，结果就有差异..</p>
<p>不过这八道题做起来还是很有价值的，不是像PAT、LeetCode那样的一个算法知识点，需要的是对数学算法的实现，还是比较有趣的~</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/10/koa-learn-3-2019-01-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/koa-learn-3-2019-01-10/" itemprop="url">
                  Koa源码学习（3）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-10 10:07:44 / Modified: 15:05:13" itemprop="dateCreated datePublished" datetime="2019-01-10T10:07:44+08:00">2019-01-10</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/10/koa-learn-3-2019-01-10/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/10/koa-learn-3-2019-01-10/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看完了大体的内容，对一些细枝末节再看一下，最后看一下test和benchmark的代码，并作出一个总结。</p>
<hr>
<h2 id="一些细节"><a href="#一些细节" class="headerlink" title="一些细节"></a>一些细节</h2><h3 id="error-handling"><a href="#error-handling" class="headerlink" title="error handling"></a>error handling</h3><p>Koa的error处理的函数有两个，一个是在<code>application.js</code>中的<code>app.onerror</code>，一个是<code>context.js</code>中的<code>ctx.onerror</code>.</p>
<p>前者，是一个默认的错误处理函数，如果用户设置了自己的错误处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.on(<span class="string">'error'</span>, (err) =&gt; &#123;...&#125;)</div></pre></td></tr></table></figure>
<p>那就不会用到这个。<br>（其实这个的功能就是简单的输出一下原始的错误信息）</p>
<p>前者是给服务端看的，用来log错误信息。</p>
<p>后者，是在发生错误后如何反映给客户端的，在上一篇中写过了。</p>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>Koa用的是Jest，似乎看起来很不错的样子。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">"jest": &#123;</div><div class="line">  "testMatch": [</div><div class="line">    "**/test/!(helpers)/*.js"</div><div class="line">  ],</div><div class="line">  "coverageReporters": [</div><div class="line">    "text-summary",</div><div class="line">    "lcov"</div><div class="line">  ],</div><div class="line">  "bail": true,</div><div class="line">  "testEnvironment": "node"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置就这些，其实，Jest号称0配置，没有这些配置也可以自己找到。</p>
<p>这几项配置，在Jest的文档中：<a href="https://jestjs.io/docs/en/configuration" target="_blank" rel="external">https://jestjs.io/docs/en/configuration</a> 都可以找到，比较直观。</p>
<p><code>assert</code>用的是Node自带的测试模块，当assert失败的时候会throw<code>AssertionError</code></p>
<p>虽然自己从来没有写过测试，但是看测试的代码还是挺清楚的，毕竟，测试就要是写的简单直观。</p>
<p>之后自己的开发过程中也可以学着Test-Driven的模式，Jest的使用也特别的友好，API很清楚了，把关注点都放在测试本身上而不是这个库上。</p>
<h3 id="coverage"><a href="#coverage" class="headerlink" title="coverage"></a>coverage</h3><p>以前一直不知道coverage是啥意思，看了这个测试以及coverage之后，算是大致明白了。</p>
<p>coverage说的就是写的测试对源码的覆盖程度，是不是每行都运行过了，是不是每个branch都涉及到了，是不是每个函数都执行了之类的，算是评价测试的一个指标吧。</p>
<p>最终会生成coverage报告，说明哪些执行了多少次，也是长见识了：</p>
<p><img src="/media/15471011491615.jpg" alt="-w726"></p>
<h2 id="benchmarks"><a href="#benchmarks" class="headerlink" title="benchmarks"></a>benchmarks</h2><p>这里用的简单的bash脚本跑的测试，用<code>wrk</code>去发请求来测试..</p>
<p>主要是对中间件的数量测试性能，测试加载了许多中间件或者异步中间件之后，性能表现怎么样。</p>
<p>代码其实比较简单。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="关于Koa"><a href="#关于Koa" class="headerlink" title="关于Koa"></a>关于Koa</h3><p>看完Koa，好吧，其实是有一些失落的，还没有当初看lodash的时候那种感觉。</p>
<p>因为，Koa真的是一个极简的框架啊！！什么多余的功能都没有，核心的代码就几十行。就是把中间件compose起来，作为中间件夹在请求与响应之间。</p>
<p>大致流程就是：</p>
<p>http reqeust -&gt;(封装，处理)-&gt; ctx -&gt; (穿过中间件，自己的逻辑也在其中) -&gt; http response</p>
<p>其实，一个后端框架，本质上就是这些了，处理HTTP请求响应，至于什么路由啊、什么authentication啊、MVC啊，都是人为设定的Design Pattern.</p>
<p>看过代码最大的收获就是认识了后端框架的核心，并不是那么神秘，希望自己通过学习对后端有更多的认识吧~</p>
<h3 id="关于Project"><a href="#关于Project" class="headerlink" title="关于Project"></a>关于Project</h3><p>除了源码的学习，自己对开发的一些规范以及工具有一定的了解吧，也算是一个收获。</p>
<p>了解了代码test, coverage, benchmark，基本都算是第一次接触，相信之后自己写代码的时候，也会逐渐写一些测试。</p>
<p>了解了JSDoc标注，<code>debug</code>, <code>eslint</code>等一些helper library，总的来说，还是学到了很多，虽然很多都是皮毛。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/03/koa-learn-2-2019-01-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/koa-learn-2-2019-01-03/" itemprop="url">
                  Koa源码学习（2）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-03 21:19:08" itemprop="dateCreated datePublished" datetime="2019-01-03T21:19:08+08:00">2019-01-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-10 10:07:19" itemprop="dateModified" datetime="2019-01-10T10:07:19+08:00">2019-01-10</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/03/koa-learn-2-2019-01-03/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/03/koa-learn-2-2019-01-03/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="context-js"><a href="#context-js" class="headerlink" title="context.js"></a><code>context.js</code></h2><p>这一部分，定义了Koa的Context对象，其实，这一部分，粗略的看过去，就是把Koa的<code>request</code>和<code>response</code>两个对象合到一个<code>context</code>里边，同时加了一些错误处理的便捷方式。</p>
<h3 id="delegation"><a href="#delegation" class="headerlink" title="delegation"></a>delegation</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">delegate(proto, <span class="string">'response'</span>)</div><div class="line">  .method(<span class="string">'attachment'</span>)</div><div class="line">  .method(<span class="string">'redirect'</span>)</div><div class="line">  ...</div><div class="line">  </div><div class="line">delegate(proto, <span class="string">'request'</span>)</div><div class="line">  .method(<span class="string">'acceptsLanguages'</span>)</div><div class="line">  .method(<span class="string">'acceptsEncodings'</span>)</div><div class="line">  ...</div></pre></td></tr></table></figure>
<p>最后这一部分代码，就是让<code>ctx</code>可以方便的使用<code>response</code>和<code>request</code>里的东西，做了一个delegate，本来需要：<code>ctx.response.attachment()</code>，这样只需要：<code>ctx.attachment()</code>.</p>
<h3 id="异常-错误处理"><a href="#异常-错误处理" class="headerlink" title="异常/错误处理"></a>异常/错误处理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">assert: httpAssert, <span class="comment">// &gt;&gt;: wrap http-assert into context</span></div><div class="line"></div><div class="line"><span class="keyword">throw</span>(...args) &#123; <span class="comment">// &gt;&gt;: wrap throw function</span></div><div class="line">  <span class="keyword">throw</span> createError(...args);</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>用的分别是<code>http-assert</code>和<code>http-errors</code>来进行assert和error处理</p>
<h4 id="this-onerror-error-的处理："><a href="#this-onerror-error-的处理：" class="headerlink" title="this.onerror(error){...}的处理："></a><code>this.onerror(error){...}</code>的处理：</h4><p>```js // delegate<br>this.app.emit(‘error’, err, this); // &gt;&gt;: here pass the context<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在这里发生的错误，也告知给application，这样可以让application做出相应的处理。</div><div class="line">这里同时还把`this`传了过去，这样app可以得到context.</div><div class="line"></div><div class="line">```js</div><div class="line">let headerSent = false; // &gt;&gt;: already sent</div><div class="line">if (this.headerSent || !this.writable) &#123;</div><div class="line">  headerSent = err.headerSent = true;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">// nothing we can do here other</div><div class="line">// than delegate to the app-level</div><div class="line">// handler and log.</div><div class="line">if (headerSent) &#123;</div><div class="line">  return;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里判断是不是需要对客户端做出response，如果已经sent了，那么就不用做啥了，否则需要处理response返回给客户端。</p>
<p>后边的代码无非是对不同情况的判断，做出合适的response。</p>
<h3 id="Cookies处理"><a href="#Cookies处理" class="headerlink" title="Cookies处理"></a>Cookies处理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> COOKIES = <span class="built_in">Symbol</span>(<span class="string">'context#cookies'</span>);</div></pre></td></tr></table></figure>
<p>生成一个唯一的symbol</p>
<p>get和set分别是这样的操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">get cookies() &#123;</div><div class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>[COOKIES]) &#123;</div><div class="line">    <span class="keyword">this</span>[COOKIES] = <span class="keyword">new</span> Cookies(<span class="keyword">this</span>.req, <span class="keyword">this</span>.res, &#123;</div><div class="line">      <span class="attr">keys</span>: <span class="keyword">this</span>.app.keys,</div><div class="line">      <span class="attr">secure</span>: <span class="keyword">this</span>.request.secure</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>[COOKIES];</div><div class="line">&#125;,</div><div class="line"></div><div class="line">set cookies(_cookies) &#123;</div><div class="line">  <span class="keyword">this</span>[COOKIES] = _cookies;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>判断如果cookie不存在的话，生成之。</p>
<p>OK，以上就是<code>context</code>的全部内容，主要的工作，还是把<code>request</code>和<code>response</code>合成一个。</p>
<h2 id="request-js"><a href="#request-js" class="headerlink" title="request.js"></a><code>request.js</code></h2><p>700+ line的文件，其实，比较容易看懂，绝大部分的内容，都是对node原有的req的封装和简易处理。</p>
<p><code>inspect()</code>, <code>toJSON()</code>和之前的没有太大的区别。</p>
<p>大量的内容，都是对原来的<code>req</code>的封装，好奇这里为什么不用delegate直接写完，非要写这么多的代码。</p>
<h3 id="原模原样access的有："><a href="#原模原样access的有：" class="headerlink" title="原模原样access的有："></a>原模原样access的有：</h3><ul>
<li>header/headers: 请求头</li>
<li>url</li>
<li>method: 请求方法，比如<code>GET</code></li>
<li>socket</li>
</ul>
<h3 id="添加处理的："><a href="#添加处理的：" class="headerlink" title="添加处理的："></a>添加处理的：</h3><ul>
<li>origin: protocol://host</li>
<li>href: href</li>
<li>host: 获取host</li>
<li>hostname: 获取hostname</li>
<li>URL: 返回URL对象，lazy生成</li>
<li>fresh: last-modified/etag 是否匹配</li>
<li>stale: !fresh，已经修改了，需要重新获取</li>
<li>idempotent: 看请求方法是不是安全的</li>
<li>charset: content-type里的charset</li>
<li>length: content-length</li>
<li>protocol: 使用的协议，http/https等</li>
<li>ips: 当proxy存在的时候，得到ip list</li>
<li>ip: remote address</li>
<li>subdomains: 获取subdomain数组</li>
<li>secure: 判断是不是https</li>
<li>path: path</li>
<li>query: 路径里的query信息</li>
<li>querystring</li>
<li>search: querystring带前边的问号</li>
</ul>
<h3 id="其它一些method-property"><a href="#其它一些method-property" class="headerlink" title="其它一些method/property:"></a>其它一些method/property:</h3><p><code>accept</code>, <code>acceptsEncodings</code>, <code>acceptsCharsets</code>, <code>acceptsLanguages</code>:</p>
<p>判断请求是否accept对应的类型，用的<code>accepts</code></p>
<p><code>is</code>:</p>
<p>判断请求的content-type是不是自己想要的，用的<code>type-is</code></p>
<p><code>type</code>:</p>
<p>返回MIME类型</p>
<p><code>get</code>:</p>
<p>get对应的header内容，这里还处理了<code>referer</code>的拼写错误，自己也是第一次注意到。</p>
<p>总结来看，<code>request</code>部分做的，就是对于node的<code>req</code>的封装，同时添加了一些helper方法，比如<code>accept</code>，<code>is</code>等。</p>
<h2 id="response-js"><a href="#response-js" class="headerlink" title="response.js"></a><code>response.js</code></h2><p>不出意外的话，Response也是对Node的<code>res</code>的封装，看一看有什么值得看的地方。</p>
<h3 id="access原来Node的res"><a href="#access原来Node的res" class="headerlink" title="access原来Node的res"></a>access原来Node的<code>res</code></h3><ul>
<li>socket</li>
<li>status</li>
<li>statusMessage</li>
<li>statusMessage=</li>
<li>headers</li>
<li>length=: content-length</li>
<li>headerSent</li>
<li>etag=</li>
<li>flushHeaders</li>
</ul>
<h3 id="添加处理的"><a href="#添加处理的" class="headerlink" title="添加处理的"></a>添加处理的</h3><ul>
<li>status=: 加入了一些验证，以及对body的处理（如果对应的status body为空，需要设置）</li>
<li>length: content-length，如果没有的话，自己需要得到body的长度</li>
<li>type=: 设置content-type，有一定判断</li>
<li>lastModified: 有一个时间的转换</li>
<li>lastModified=</li>
<li>etag: 考虑了ETag的两种格式</li>
<li>type: content-type，去除了后边诸如<code>charset</code>之类的东西</li>
<li>header处理：<ul>
<li><code>get</code>: 获取header</li>
<li><code>set</code>: setHeader的封装，支持多种方式</li>
<li><code>append</code>: append header</li>
<li><code>remove</code>: remove header</li>
</ul>
</li>
<li>writable: 是否可写，<code>socket.writable</code>，如果已经完成不可写</li>
</ul>
<h3 id="自己的property-method"><a href="#自己的property-method" class="headerlink" title="自己的property/method"></a>自己的property/method</h3><p><code>body</code>:</p>
<p>操作http的body，需要进行不同情况的处理</p>
<ul>
<li>内容为null: 204</li>
<li>如果没有设定过status，设为200</li>
<li>没有设置<code>content-type</code>，需要进行设定</li>
<li>对于不同类型的数据：<ul>
<li>string: 设定length, type</li>
<li>buffer: type设为<code>bin</code></li>
<li>stream:</li>
<li>json: 设定type，remove <code>content-type</code></li>
</ul>
</li>
</ul>
<p><code>vary</code>:</p>
<p>设置<code>Vary</code>header</p>
<p><code>redirect</code>:</p>
<p>重定向！<br>-如果参数是back: 回到上一页面<br>-设置status为302<br>-说明这在redirect</p>
<p><code>attachment</code>:</p>
<p>当有附加文件的时候，设置<code>Content-Disposition</code> header，同时设置<code>Content-Type</code>，用到了<code>content-disposition</code>包</p>
<p><code>is</code>:</p>
<p>判断type是否满足，类似<code>request</code>的</p>
<p>总体来看，<code>response</code>和<code>request</code>非常相似，封装<code>res</code>，方便处理Node Response的header和body等</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/27/koa-learn-12018-12-27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/27/koa-learn-12018-12-27/" itemprop="url">
                  Koa源码学习（1）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-27 14:34:17 / Modified: 14:34:42" itemprop="dateCreated datePublished" datetime="2018-12-27T14:34:17+08:00">2018-12-27</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/27/koa-learn-12018-12-27/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/12/27/koa-learn-12018-12-27/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>感觉代码不多，就生看代码了，从<code>application.js</code>开始。</p>
<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a><code>debug</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'koa:application'</span>); <span class="comment">// &gt;&gt;: debug usage, brilliant</span></div></pre></td></tr></table></figure>
<p>这个库的使用，看起来还是很不错的，可以控制输出哪些debug信息，以后项目中可以用下</p>
<h3 id="customize打印application对象"><a href="#customize打印application对象" class="headerlink" title="customize打印application对象"></a>customize打印application对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (util.inspect.custom) &#123; <span class="comment">// &gt;&gt;: inspect</span></div><div class="line">  <span class="keyword">this</span>[util.inspect.custom] = <span class="keyword">this</span>.inspect;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Return JSON representation.</div><div class="line"> * We only bother showing settings.</div><div class="line"> *</div><div class="line"> * @return &#123;Object&#125;</div><div class="line"> * @api public</div><div class="line"> */</div><div class="line"></div><div class="line">toJSON() &#123;</div><div class="line">  <span class="keyword">return</span> only(<span class="keyword">this</span>, [</div><div class="line">    <span class="string">'subdomainOffset'</span>,</div><div class="line">    <span class="string">'proxy'</span>,</div><div class="line">    <span class="string">'env'</span></div><div class="line">  ]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Inspect implementation.</div><div class="line"> *</div><div class="line"> * @return &#123;Object&#125;</div><div class="line"> * @api public</div><div class="line"> */</div><div class="line"></div><div class="line">inspect() &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.toJSON();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为还有<code>context</code>,<code>request</code>,<code>response</code>等对象，可能并没有toString的方法，就不输出它们，这里定制的方式值得学习一下：<code>this[util.inspect.custom] = this.inspect</code></p>
<h3 id="use"><a href="#use" class="headerlink" title="use()"></a><code>use()</code></h3><p>就是简单的把中间件放到自己的<code>middleware</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.middleware.push(fn);</div></pre></td></tr></table></figure>
<h3 id="callback"><a href="#callback" class="headerlink" title="callback()"></a><code>callback()</code></h3><p>koa的listen其实就是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</div><div class="line"><span class="keyword">return</span> server.listen(...args);</div></pre></td></tr></table></figure>
<p>自己的东西的注入，都是在<code>callback()</code>里完成的</p>
<p>node文档：</p>
<blockquote>
<p>http.createServer([options][, requestListener])<br>The requestListener is a function which is automatically added to the <code>&#39;request&#39;</code> event.</p>
</blockquote>
<p>意思大概就是，每次有request时间，都会调用这个函数吧。</p>
<p>在里边封装了自己的处理方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> handleRequest = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> ctx = <span class="keyword">this</span>.createContext(req, res);</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.handleRequest(ctx, fn);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">return</span> handleRequest;</div></pre></td></tr></table></figure>
<h3 id="compose"><a href="#compose" class="headerlink" title="compose()"></a><code>compose()</code></h3><p>嗯，其实就是把所有的中间件串起来，<code>Promise</code>的使用，自己还是需要学习啊</p>
<h3 id="createContext-req-res"><a href="#createContext-req-res" class="headerlink" title="createContext(req, res)"></a><code>createContext(req, res)</code></h3><p>对原来的<code>request</code>和<code>response</code>的一个封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">createContext(req, res) &#123;</div><div class="line">  <span class="keyword">const</span> context = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.context);</div><div class="line">  <span class="keyword">const</span> request = context.request = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.request);</div><div class="line">  <span class="keyword">const</span> response = context.response = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.response);</div><div class="line">  context.app = request.app = response.app = <span class="keyword">this</span>;</div><div class="line">  context.req = request.req = response.req = req;</div><div class="line">  context.res = request.res = response.res = res;</div><div class="line">  request.ctx = response.ctx = context;</div><div class="line">  request.response = response;</div><div class="line">  response.request = request;</div><div class="line">  context.originalUrl = request.originalUrl = req.url;</div><div class="line">  context.state = &#123;&#125;;</div><div class="line">  <span class="keyword">return</span> context;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实还是很简单的，就主要是几个绑定，互相绑一绑，然后和node原来的req, res绑一绑</p>
<h3 id="handleRequest-ctx-fn"><a href="#handleRequest-ctx-fn" class="headerlink" title="handleRequest(ctx, fn)"></a><code>handleRequest(ctx, fn)</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">handleRequest(ctx, fnMiddleware) &#123;</div><div class="line">  <span class="keyword">const</span> res = ctx.res;</div><div class="line">  res.statusCode = <span class="number">404</span>;</div><div class="line">  <span class="keyword">const</span> onerror = <span class="function"><span class="params">err</span> =&gt;</span> ctx.onerror(err);</div><div class="line">  <span class="keyword">const</span> handleResponse = <span class="function"><span class="params">()</span> =&gt;</span> respond(ctx);</div><div class="line">  onFinished(res, onerror);</div><div class="line">  <span class="keyword">return</span> fnMiddleware(ctx).then(handleResponse).catch(onerror);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实有些看不太懂…</p>
<p>为什么，要用<code>handleResponse</code>而不直接用<code>respond</code>，为什么用ctx，而不用middleware处理之后的ctx</p>
<p>为什么要有<code>onFinish()</code>，感觉并不会有什么用</p>
<h4 id="respond"><a href="#respond" class="headerlink" title="respond"></a><code>respond</code></h4><p>这个helper function，里边就是各种对不同情况的处理，这个看具体response的源码的时候再说吧</p>
<hr>
<p>嗯，感觉看完<code>application.js</code>，也就那么回事，就是处理中间件，而已，可能这就是Koa有趣的地方吧，精简的核心，统一的接口，无限可能的拓展。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/26/koa-learn-0-2018-12-26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/26/koa-learn-0-2018-12-26/" itemprop="url">
                  Koa源码学习（0）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-26 14:42:48 / Modified: 14:44:06" itemprop="dateCreated datePublished" datetime="2018-12-26T14:42:48+08:00">2018-12-26</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/26/koa-learn-0-2018-12-26/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/12/26/koa-learn-0-2018-12-26/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一直想看点库的源码，后来发现，Koa好像只有几千行，那就拿它开刀啦~</p>
<p>现场clone，版本应该是<code>2.6.2</code>，2018-10-6的</p>
<hr>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>也算是学习一下一个开源项目如何组织吧…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── .editorconfig</div><div class="line">├── .eslintrc.yml</div><div class="line">├── .git</div><div class="line">├── .gitignore</div><div class="line">├── .mailmap</div><div class="line">├── .npmrc</div><div class="line">├── .travis.yml</div><div class="line">├── AUTHORS</div><div class="line">├── CODE_OF_CONDUCT.md</div><div class="line">├── History.md</div><div class="line">├── LICENSE</div><div class="line">├── Readme.md</div><div class="line">├── /benchmarks</div><div class="line">├── /docs</div><div class="line">├── /lib</div><div class="line">├── package.json</div><div class="line">└── /test</div></pre></td></tr></table></figure>
<ul>
<li><code>Readme.md</code>: 不解释，字面意思</li>
<li><code>LICENSE</code>: 开源项目的license，目前自己不太懂，有空了解一下，先不管，跟代码无关</li>
<li><code>History.md</code>: 记录项目时间线，嗯，很有必要，似乎部分还是自动生成的，像GitHub的issue，PR等等还是需要进一步的学习</li>
<li><code>CODE_OF_CONDUCT.md</code>: 有趣，行为守则声明，原来开源项目还有这个</li>
<li><code>AUTHORS</code>: 不解释</li>
<li><code>.git</code>, <code>.gitignore</code>: 不解释</li>
<li><code>.mailmap</code>: 可能是一个author-mail的对应吧，不过里边只有一个名字，很奇怪</li>
<li><code>.editorconfig</code>: 一个更改Editor/IDE编辑器的设置工具，读取文件，然后改变IDE/Editor的设置，高级啊！！！<a href="https://editorconfig.org/" target="_blank" rel="external">https://editorconfig.org/</a></li>
<li><code>.eslintrc.yml</code>: eslint的配置，eslint自己也需要进一步的学习</li>
<li><code>.npmrc</code>: npm的配置，加一句<code>package-lock=false</code>就可以不生成<code>package-lock.json</code>，学习到了</li>
<li><code>.travis.yml</code>: TravisCI相关的东西，等看它测试的时候再说吧</li>
<li><code>package.json</code>: npm的dependency、scripts等配置，入口！第一个与代码相关的文件</li>
<li><code>lib</code>: 源码</li>
<li><code>test</code>: 测试代码，测试需要好好学习一下</li>
<li><code>docs</code>: 文档</li>
<li><code>benchmarks</code>: 性能测试</li>
</ul>
<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><p>读所有node项目源码的第一步…</p>
<p>npm官方文档关于<code>package.json</code>的：<a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="external">https://docs.npmjs.com/files/package.json</a></p>
<ul>
<li><code>name</code>, <code>version</code>: 必须，用于identify一个npm包</li>
<li><code>description</code>, <code>keywords</code>: optional 用于npm serach的时候</li>
<li><code>license</code>: 暂不解释</li>
</ul>
<h3 id="main"><a href="#main" class="headerlink" title="main"></a><code>main</code></h3><blockquote>
<p>The main field is a module ID that is the primary entry point to your program. That is, if your package is named foo, and a user installs it, and then does require(“foo”), then your main module’s exports object will be returned.</p>
</blockquote>
<p>之前一直觉得没啥用，原来这么关键，就是require的时候，返回的对象</p>
<h3 id="files"><a href="#files" class="headerlink" title="files"></a><code>files</code></h3><blockquote>
<p>The optional files field is an array of file patterns that describes the entries to be included when your package is installed as a dependency.</p>
</blockquote>
<p>也很有用，当别人依赖这个包的时候，不是装所有的包，而是只装所包含的文件</p>
<p>所谓<code>npm install</code>，其实就是把文件下载下来放到node_modules里，没啥神奇的</p>
<h3 id="repository"><a href="#repository" class="headerlink" title="repository"></a><code>repository</code></h3><p>repo的位置，默认GitHub，加上后边的路径，所以就是<code>koajs/koa</code>了</p>
<h3 id="engines"><a href="#engines" class="headerlink" title="engines"></a><code>engines</code></h3><p>声明node版本吧</p>
<h3 id="jest"><a href="#jest" class="headerlink" title="jest"></a><code>jest</code></h3><p>jest的配置，感觉放在<code>package.json</code>里不如放在<code>jest.config.js</code>里，这个日后再看</p>
<h3 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a><code>dependencies</code></h3><p>依赖，如果<code>npm -i -s</code>的话，会自动加进去</p>
<h3 id="devDependencies"><a href="#devDependencies" class="headerlink" title="devDependencies"></a><code>devDependencies</code></h3><p>开发时候的依赖，如果这个项目运行的时候不需要的依赖，那就放在这里边</p>
<h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a><code>scripts</code></h3><p>执行脚本，<code>npm run xxx</code></p>
<hr>
<p>OK，所有的term都看过了，接下来，<code>npm install</code>吧</p>
<p>跑一跑<code>scripts</code>里边的几个命令，注意bench的时候，没有安装<code>wrk</code>，先装一下</p>
<h2 id="第一个Koa应用"><a href="#第一个Koa应用" class="headerlink" title="第一个Koa应用"></a>第一个Koa应用</h2><p>官方的tutorial:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'../koa'</span>);</div><div class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</div><div class="line"></div><div class="line"><span class="comment">// response</span></div><div class="line">app.use(<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</div><div class="line">  ctx.body = <span class="string">'Hello Koa'</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><p>现在有个问题是，如何调试，node应用，如何打断点，单步运行呢？</p>
<p>先看一看官方的guide吧：<a href="https://nodejs.org/en/docs/guides/debugging-getting-started/" target="_blank" rel="external">https://nodejs.org/en/docs/guides/debugging-getting-started/</a></p>
<p>官方指引的Debug NodeJS in Chrome: <a href="https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27" target="_blank" rel="external">https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27</a></p>
<p>发现新大陆啊！！！</p>
<p>嗯嗯，vscode的配置也很简单，甚至帮你自动完成！</p>
<p>自此，准备工作结束，开始源码之旅~</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/22/nodejs-real-time-application-2018-12-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/22/nodejs-real-time-application-2018-12-22/" itemprop="url">
                  Real-Time Application in NodeJS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-22 22:31:05" itemprop="dateCreated datePublished" datetime="2018-12-22T22:31:05+08:00">2018-12-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-25 18:46:45" itemprop="dateModified" datetime="2018-12-25T18:46:45+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/22/nodejs-real-time-application-2018-12-22/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/12/22/nodejs-real-time-application-2018-12-22/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近阅读<em>Mastering Node.js</em>一书，看到第六章，觉得书中的几个例子都特别有代表性，所以自己也事项一遍，顺便做点笔记，以备以后参阅。</p>
<hr>
<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><p>第一节讲的是AJAX，可能之前比较熟悉吧，或者说，我这一代人可能从来没有接触过那种一个URL，获取HTML文件，里边并不能做什么其它事情的WEB时代。</p>
<p>AJAX主要就是这个<strong>A</strong>，异步，可以让浏览器在自己想向server获取数据的时候发出请求，并在服务器返回之后做相应的处理，而不用请求整个文档，我目前的理解大致就是这样，不做过多叙述了。</p>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>socket的确之前接触的不多，感觉的确很神奇，如何做到实时的通信呢？很是好奇。</p>
<p>不过看过之后，发现其并不是走HTTP协议，所以不是什么黑科技了，而是底层的浏览器所提供的功能，与server之间建立持久的TCP连接，然后相互通信。</p>
<p>书上配套的例子，一个协同画画的东西，很好的展示了websocket的功能，下边就是写的一些说明，备以后查阅。</p>
<h3 id="co-draw"><a href="#co-draw" class="headerlink" title="co-draw"></a>co-draw</h3><p>代码：<a href="https://github.com/brickmaker/node-real-time-demo/tree/master/co-draw" target="_blank" rel="external">https://github.com/brickmaker/node-real-time-demo/tree/master/co-draw</a></p>
<h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p>server端的代码非常简单，直接复制过来，因为基本没有特别的与socket.io无关的内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</div><div class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</div><div class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</div><div class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app.callback());</div><div class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server);</div><div class="line"></div><div class="line">app.use(serve(__dirname + <span class="string">'/public'</span>));</div><div class="line"></div><div class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`client <span class="subst">$&#123;socket.id&#125;</span> connected`</span>)</div><div class="line"></div><div class="line">  socket.on(<span class="string">'draw'</span>, data =&gt; &#123;</div><div class="line">    socket.broadcast.emit(<span class="string">'draw'</span>, data)</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">8102</span>);</div></pre></td></tr></table></figure>
<p>用了<code>Koa</code>，用<code>koa-static</code>来serve前端文件，Koa和socket.io的接入可能需要记一下，好像并不是那么想当然。</p>
<p>服务端监听客户端的连接，并可以得到客户端的socket，进行后续操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;...&#125;)</div></pre></td></tr></table></figure>
<p>在回调里就可以写一些逻辑了。</p>
<h4 id="client"><a href="#client" class="headerlink" title="client"></a>client</h4><p>客户端初始化<code>socket.io</code>很简单：</p>
<p>在<code>index.html</code>中加入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后在scripts中加一条：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> socket = io.connect(<span class="string">'/'</span>);</div></pre></td></tr></table></figure>
<p>就OK了，觉得很神奇。</p>
<p>至于操作，这里只用到了两个：</p>
<ol>
<li>在自己绘制的时候，向server发消息：“我在绘制…”，并附上绘制的数据</li>
<li>监听服务器传来别人绘制的消息，然后把别人画的也加上来</li>
</ol>
<p>OK，基本就是这样。</p>
<h2 id="SSE-Server-Sent-Events"><a href="#SSE-Server-Sent-Events" class="headerlink" title="SSE(Server Sent Events)"></a>SSE(Server Sent Events)</h2><p>顾名思义，就是server向客户端发送消息，不过其实这一点websocket也可以做，这可能也是之前自己从来没有听过这个名词的原因吧。</p>
<p>它的好处可能就是用的是HTTP协议，然后比较简单吧，具体的看Stack Overflow上的两者对比：<a href="https://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource" target="_blank" rel="external">https://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource</a></p>
<h3 id="Real-time-Q-amp-A"><a href="#Real-time-Q-amp-A" class="headerlink" title="Real-time Q&amp;A"></a>Real-time Q&amp;A</h3><p>唔，写到后边都不太想写了，真的，参考价值不大，其实关于SSE的很少，不过还是要学习一下这种方式。</p>
<p>代码：<a href="https://github.com/brickmaker/node-real-time-demo/tree/master/real-time-QA" target="_blank" rel="external">https://github.com/brickmaker/node-real-time-demo/tree/master/real-time-QA</a></p>
<p>说白了，就这个例子来看，其实就相当于，建立了一个持久的HTTP连接，然后有数据就写数据，没有什么特别的，只不过都通过那个HTTP发，然后断了之后能重新连上。</p>
<h4 id="server-1"><a href="#server-1" class="headerlink" title="server"></a>server</h4><p>服务端，拿到客户端请求Event Source时候的socket，存下来，想给谁发数据的时候，直接<code>socket.write()</code>就OK了。</p>
<h4 id="client-1"><a href="#client-1" class="headerlink" title="client"></a>client</h4><p>客户端的连接也比较简单：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> eventSource = <span class="keyword">new</span> EventSource(<span class="string">'/event-source'</span>);</div></pre></td></tr></table></figure>
<p>然后就是各种<code>addEventListener(...)</code>来监听消息。</p>
<p>值得注意的是，可以设定不同的事件，是通过字符串的方式设定的，比如这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">clientSocket.write(<span class="string">`event: <span class="subst">$&#123;event&#125;</span>\n`</span>);</div><div class="line">clientSocket.write(<span class="string">`data: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>\n\n`</span>);</div></pre></td></tr></table></figure>
<p>客户端监听对应的事件类别就可以了~</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/d3-learn-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/d3-learn-1/" itemprop="url">
                  D3.js 学习笔记-01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-06 19:49:01 / Modified: 19:51:20" itemprop="dateCreated datePublished" datetime="2018-11-06T19:49:01+08:00">2018-11-06</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Data-Visualization/" itemprop="url" rel="index"><span itemprop="name">Data Visualization</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/06/d3-learn-1/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/11/06/d3-learn-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>曾经觉得D3超级难用，API反人类，好多东西跟现代的JS不符，上手不容易…<br>后来，当开始用D3之后，发现，自己误会了D3.js的定位，D3的丰富与灵活超乎了自己的想象，于是决定认真地学习下这个古老而又有极强生命力的库！</p>
<hr>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>阅读D3的Overview：<a href="https://d3js.org/" target="_blank" rel="external">https://d3js.org/</a></p>
<p>虽然篇幅很短，但是介绍了D3的核心特性，个人总结两点：</p>
<ol>
<li><strong>强大的DOM操作功能</strong></li>
<li><strong>Data-&gt;DOM 的 transformation</strong></li>
</ol>
<p>感觉D3的核心功能就这么两个，它的API也是为这两个而服务的，习惯了之后特别的简洁和自然。</p>
<p>DOM操作功能不必说，跟JQuery类似，对DOM的获取、属性修改等操作非常容易，不过D3强大的地方在于，由于是Data Driven的，对于DOM操作的动态性以及与数据的贴合性非常的好，使其在用DOM显示数据上有很大的优势！</p>
<p>第二项，非常的优秀！</p>
<blockquote>
<p>Transformation, not Representation</p>
</blockquote>
<p>这是D3的一个特性，其所有的显示，都是普普通通的DOM元素，图形是SVG之类的，没有自己的一套表现，D3的重点不在于此，而是在于转化上，将普通的数据，能够很便利的映射到DOM上，通过丰富的SVG的表现力，来呈现可视化图形。</p>
<p>加上许多D3的插件或者辅助功能，D3的能力被大幅的提升，比如<code>d3-force</code>，运用力引导图的算法布局图，然后运用d3来呈现出来，其实算法本身跟显示关系并不大，只需要将每个点的位置算出来即可，但是由于D3生态的丰富以及表现的方便，于是就与其结合了起来。现在去找一个力引导布局的算法，首选还是<code>d3-force</code>。</p>
<h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><p>没有找到官方的Tutorial，这很难过，D3的所有官方文档，都在GitHub Repo的wiki里：<a href="https://github.com/d3/d3/wiki" target="_blank" rel="external">https://github.com/d3/d3/wiki</a> 而其中的tutorial部分，其实就是一个awesome-list，虽然很多，但没有系统完整的，非常的不友好！</p>
<p>不过有几个东西还是很值得参考的：</p>
<ol>
<li>API Reference，不管什么，reference都是必须的，写的还算明白，不过不能拿来学习：<a href="https://github.com/d3/d3/blob/master/API.md" target="_blank" rel="external">https://github.com/d3/d3/blob/master/API.md</a></li>
<li>Gallery：<a href="https://github.com/d3/d3/wiki/Gallery" target="_blank" rel="external">https://github.com/d3/d3/wiki/Gallery</a> 现在应该所有的例子，都放在了Observable上，这是个类似于notebook的新玩意，似乎还挺好玩的</li>
<li>Observable上的visualization collection：<a href="https://beta.observablehq.com/collection/@observablehq/visualization" target="_blank" rel="external">https://beta.observablehq.com/collection/@observablehq/visualization</a></li>
</ol>
<p>目前打算是稍微看下Observable这个东西，然后挑感兴趣的例子去看如何实现，然后尝试自己写一些！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/ES6-module-2018-10-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xiaodong Zhao">
      <meta itemprop="description" content="Coder love Design">
      <meta itemprop="image" content="/images/pic_reverse.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaodong's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/ES6-module-2018-10-23/" itemprop="url">
                  ES6 Module学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-23 11:09:23" itemprop="dateCreated datePublished" datetime="2018-10-23T11:09:23+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-22 22:38:05" itemprop="dateModified" datetime="2018-12-22T22:38:05+08:00">2018-12-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/23/ES6-module-2018-10-23/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/10/23/ES6-module-2018-10-23/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一直对ES6都是知识了解其大致的feature，却从来没有用过，也不知道怎么用…<br>一直对前端的组织、打包不了解，类似Babel、Webpack、Browsify这些看着都是避而远之…<br>一直对React、Vue这些框架的使用都是套scaffold，根本不知道其中是怎样运作的，脱离了脚手架完全不会写…</p>
<p>可是，这样终归是不行的，终于下定决心去了解，去使用这些东西，真正接触现代的JavaScript！</p>
<hr>
<h2 id="浏览器script标签"><a href="#浏览器script标签" class="headerlink" title="浏览器script标签"></a>浏览器script标签</h2><p>好吧，我以前只知道<code>script</code>标签是把<code>src</code>中指的文件复制过来，现在发现自己已经火星了，去年chrome就支持了引入module，好吧，这样看来，如果就自己用新版的Chrome的话，一切变得简单起来~</p>
<p>写一个最简单的demo，虽然很直白，但毕竟纪念一下自己第一次使用module:</p>
<p>index.html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  hello world</div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>index.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> a <span class="keyword">from</span> <span class="string">'./a.js'</span></div><div class="line"><span class="built_in">console</span>.log(a.aaa)</div></pre></td></tr></table></figure>
<p>a.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> aaa = <span class="number">3</span></div></pre></td></tr></table></figure>
<p>console:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">3</div></pre></td></tr></table></figure>
<p>可以看出，如果浏览器支持的话，只要加个<code>type=&#39;module&#39;</code>就可以，不用什么编译工具呀，打包工具呀之类的。</p>
<h2 id="Module怎么用？？？"><a href="#Module怎么用？？？" class="headerlink" title="Module怎么用？？？"></a>Module怎么用？？？</h2><p>其实目前自己对module的理解就是很不具体，可能就是能分成好多个文件写，避免一个文件写的太长；把一些公用的东西提出来，比如config、常数之类的供复用；隔离作用域之类的…</p>
<p>这些应该都是没有错的，可是真正让自己用的时候，就觉得，没那么简单，它到底是干什么用的？什么时候该用？什么时候不该用？有什么范式嘛？有什么best practice吗？</p>
<p>这些可能需要长期使用后才有体会吧，目前自己可以先学习一点..</p>
<p>这里，我觉得讲了一点比较具体的东西，感觉应该值得一看，这本书好像都挺不错的样子：<br><a href="http://exploringjs.com/es6/ch_modules.html#sec_modules-in-javascript" target="_blank" rel="external">http://exploringjs.com/es6/ch_modules.html#sec_modules-in-javascript</a><br><a href="http://exploringjs.com/es6/ch_modules.html#sec_design-goals-es6-modules" target="_blank" rel="external">http://exploringjs.com/es6/ch_modules.html#sec_design-goals-es6-modules</a></p>
<p>具体的，就不再说了，毕竟没有什么使用经验，以后可以补上…</p>
<h2 id="编译与打包"><a href="#编译与打包" class="headerlink" title="编译与打包"></a>编译与打包</h2><p>前边提到的是直接浏览器标签<code>type=&#39;module&#39;</code>来让js引入module。</p>
<ol>
<li>如果要给用户用呢？用户的浏览器可是无法预知的..</li>
<li>标签引入是不是不怎么好呀，如果不是http/2的话，是不是还是打包下比较好？</li>
</ol>
<p>自己虽然不懂第二点，但是目前这前端形势，第一条就决定了你除非是自己写着玩玩，否则必须使用编译到ES5以及打包的工具..</p>
<p>于是，自己要接触自己之前恐惧的名词了：Babel，Browsify，Rollup，Webpack…</p>
<p>这里自己看了一篇文风非常impressive的文章..感觉对新手来说还是很友好的：<br><a href="https://blessing.studio/how-could-i-use-es6-modules-in-production/" target="_blank" rel="external">https://blessing.studio/how-could-i-use-es6-modules-in-production/</a></p>
<p>其中这张图片比较好的说明了问题：</p>
<p><img src="/media/15402643340461.jpg" alt=""></p>
<h3 id="Babel转译工具"><a href="#Babel转译工具" class="headerlink" title="Babel转译工具"></a>Babel转译工具</h3><p>如果单纯的来说的话，Babel就是一个转译工具，把原来用ES6+的语法变成ES5的或者其它的，可是自己不解的地方在于，ES6支持的module，Babel是怎么变的？转译之后，又该如何使用呢？？</p>
<p>了解了一下，发现它好像是把module转换成CommonJS的规范，所以也不能直接<code>script</code>标签引入完事，而是要用一定的库，比如RequireJS，这个自己之后有时间再看吧，毕竟有了现成的打包工具把它变成一个bundle.js，我为何还要煞费苦心的处理这心转译之后的文件呢？还是看看一些打包工具吧。</p>
<h3 id="Webpack打包工具"><a href="#Webpack打包工具" class="headerlink" title="Webpack打包工具"></a>Webpack打包工具</h3><p>如果用一句话解释，就是官网上的slogan：</p>
<blockquote>
<p>bundle your scripts<br>bundle your styles<br>bundle your assets<br>bundle your images</p>
</blockquote>
<p>或者官网这张图：</p>
<p><img src="/media/15402643469502.jpg" alt="-w1131"></p>
<p>把有依赖的各种资源编程静态的assets，让我们不用考虑依赖之类的。</p>
<p>具体的如何整理依赖，tree-shaking什么的就先不管了，反正，最后给我一个<code>bundle.js</code>直接script引入就很合适~</p>
<p>具体的使用之后再补充吧。</p>
<h3 id="TypeScript-Webpack"><a href="#TypeScript-Webpack" class="headerlink" title="TypeScript+Webpack"></a>TypeScript+Webpack</h3><p>其实，我一直以为TypeScript和Babel是两个完全不相干的东西，也以为两者一般要同时使用，但后来经过了解发现，反着这俩都能够转换到ES5，所以用TS也不一定要用Babel~</p>
<p>那么就来入坑TS吧，配一个TypeScript+Webpack的前端项目环境吧，这样就可以优雅的支持Module了~~~</p>
<h4 id="最简单的TS-Webpack配置Demo"><a href="#最简单的TS-Webpack配置Demo" class="headerlink" title="最简单的TS+Webpack配置Demo"></a>最简单的TS+Webpack配置Demo</h4><p><strong>文件结构：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── dist</div><div class="line">│   ├── bundle.js</div><div class="line">│   └── index.html</div><div class="line">├── package-lock.json</div><div class="line">├── package.json</div><div class="line">├── src</div><div class="line">│   ├── bar.ts</div><div class="line">│   └── index.ts</div><div class="line">├── tsconfig.json</div><div class="line">└── webpack.config.js</div></pre></td></tr></table></figure>
<p><strong>安装依赖包：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  "devDependencies": &#123;</div><div class="line">    "ts-loader": "^5.2.2",</div><div class="line">    "typescript": "^3.1.3",</div><div class="line">    "webpack": "^4.22.0",</div><div class="line">    "webpack-cli": "^3.1.2"</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>tsconfig.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"compilerOptions"</span>: &#123;</div><div class="line">    <span class="attr">"outDir"</span>: <span class="string">"./dist/"</span>,</div><div class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">"module"</span>: <span class="string">"es6"</span>,</div><div class="line">    <span class="attr">"target"</span>: <span class="string">"es5"</span>,</div><div class="line">    <span class="attr">"jsx"</span>: <span class="string">"react"</span>,</div><div class="line">    <span class="attr">"allowJs"</span>: <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>webpack.config.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">entry</span>: <span class="string">'./src/index.ts'</span>,</div><div class="line">  <span class="attr">mode</span>: <span class="string">'production'</span>,</div><div class="line">  <span class="attr">devtool</span>: <span class="string">'inline-source-map'</span>,</div><div class="line">  <span class="attr">module</span>: &#123;</div><div class="line">    <span class="attr">rules</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</div><div class="line">        <span class="attr">use</span>: <span class="string">'ts-loader'</span>,</div><div class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">resolve</span>: &#123;</div><div class="line">    <span class="attr">extensions</span>: [<span class="string">'.tsx'</span>, <span class="string">'.ts'</span>, <span class="string">'.js'</span>]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">'dist'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>src/index.ts</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; greet &#125; <span class="keyword">from</span> <span class="string">'./bar'</span></div><div class="line"></div><div class="line">greet(<span class="string">"world"</span>)</div></pre></td></tr></table></figure>
<p><strong>src/bar.ts</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> greet = <span class="function">(<span class="params">a: <span class="built_in">String</span></span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`Hello <span class="subst">$&#123;a&#125;</span>`</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> &#123; greet &#125;</div></pre></td></tr></table></figure>
<p><strong>dist/index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  Hello World</div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npx webpack</div></pre></td></tr></table></figure>
<p>bundle.js就生成了~</p>
<p>这个demo反正实现了webpack打包成一个单独的bundle.js文件，且是ES5的，这样一来就可以用高端的TypeScript了，感觉牛的不行，这已经达到了原来的功能。</p>
<p>如果用webpack来管理的话，思路和原来的是很不一样的，自己也需要重新学习webpack的思路与组织方式，这就放在之后的博客来说吧哈哈哈</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/pic_reverse.png"
                alt="Xiaodong Zhao" />
            
              <p class="site-author-name" itemprop="name">Xiaodong Zhao</p>
              <p class="site-description motion-element" itemprop="description">Coder love Design</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">102</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/brickmaker" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:zhaoxiaodong0902@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiaodong Zhao</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.3.8</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://brickmaker.disqus.com/count.js" async></script>
  

  





  












  





  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
  


  
  

  

  

  

  

  

</body>
</html>
